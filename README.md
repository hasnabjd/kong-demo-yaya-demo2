# yaya-demo2

This demo was generated from the use case: **yaya**

## Structure

```
yaya-demo2/
├── .github/workflows/      # CI/CD pipelines
│   ├── ci-cd.yml          # Main CI/CD workflow
│   ├── build-customer.yml # Build pipeline
│   └── deploy-customer.yml# Deploy pipeline
├── openapi.yaml           # OpenAPI specification
├── kong/
│   ├── plugins/           # Kong plugin configurations
│   └── consumers/         # Kong consumer configurations
├── tests/                 # Test files (empty for now)
└── source-code/           # Source code (empty for now)
```

## Kong Configuration

### Plugins
The following Kong plugins are configured for this demo:

[Plugin configurations are located in the `kong/plugins/` directory]

### Consumers
Consumer configurations are located in `kong/consumers/consumers.yaml`

## Getting Started

### Prerequisites

Set up the following GitHub secrets for your repository:
- `KONG_ADMIN_URL`: Kong Admin API URL
- `KONG_ADMIN_TOKEN`: Kong Admin API token
- `KONG_PROXY_URL`: Kong Proxy URL
- `UPSTREAM_SERVER_URL`: Your backend service URL
- `DEV_PORTAL_URL`: Kong Developer Portal URL (optional)
- `DEV_PORTAL_TOKEN`: Kong Developer Portal token (optional)

### Manual Deployment

1. Apply the Kong configurations:
   ```bash
   # Apply plugin configurations
   kubectl apply -f kong/plugins/

   # Apply consumer configurations
   kubectl apply -f kong/consumers/
   ```

2. Validate the OpenAPI specification:
   ```bash
   swagger-parser validate openapi.yaml
   ```

3. Deploy using decK:
   ```bash
   deck sync --state kong/
   ```

## CI/CD Pipelines

This demo includes three GitHub Actions workflows:

### 1. Main CI/CD Pipeline (`ci-cd.yml`)
- Validates OpenAPI specifications
- Validates Kong configurations
- Runs integration tests
- Deploys to Kong (on main branch)

### 2. Build Customer Pipeline (`build-customer.yml`)
Based on [Kong APIOps patterns](https://github.com/nima-kong/customer-api), this pipeline:
- Validates and lints OpenAPI specifications
- Generates Kong configurations using `inso` CLI
- Runs API tests and security scans
- Creates build artifacts for deployment
- Supports multiple environments (dev/staging/prod)

### 3. Deploy Customer Pipeline (`deploy-customer.yml`)
Based on [Kong DevOps workflows](https://github.com/liyangau/kong-devops), this pipeline:
- Performs pre-deployment checks
- Deploys configurations using `deck`
- Updates Kong Developer Portal
- Runs post-deployment tests
- Supports environment-specific deployments

### Workflow Triggers

- **Build Pipeline**: Triggered on push/PR to main, develop, or feature branches
- **Deploy Pipeline**: Manually triggered via workflow_dispatch with environment selection
- **Main Pipeline**: Triggered on push to main/develop branches

## Kong Tools Used

- **[inso CLI](https://docs.insomnia.rest/inso-cli/introduction)**: OpenAPI validation and Kong config generation
- **[decK](https://docs.konghq.com/deck/)**: Kong configuration management
- **[Portal CLI](https://docs.konghq.com/konnect/dev-portal/dev-portal-cli/)**: Developer portal management

## Testing

Add your test files to the `tests/` directory:
- `unit-tests.json`: Insomnia unit tests
- `integration-tests.json`: Insomnia integration tests
- `postman-collection.json`: Postman collection tests

---

Generated by Kong Demo Generator on 2025-09-15 10:09:57

*Based on Kong CI/CD best practices from the Kong community*
